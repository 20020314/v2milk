kind: pipeline
type: docker
name: Win-64ğŸ¤¡
steps:
node:
  server: USA
clone:
  disable: true
steps:
- name: æ‹‰å–ä»£ç 
  image: alpine
  volumes:
  - name: cache
    path: /dist
  commands:
  - apk update
  - apk add git bash
  - cd /dist
  - git clone https://github.com/20020314/v2milk
# ä¾èµ–
- name: è®¾ç½®ç¨‹åºç›®å½•
  image: alpine
  volumes:
  - name: cache
    path: /dist
  commands:
  - apk update
  - apk add wget unzip
  - mkdir /dist/download
  - mkdir -p /dist/v2milk/APP/extra/v2ray-core/Windows
  - mkdir -p /dist/v2milk/APP/extra/v2ray-core/Linux
  - wget https://github.com/v2fly/v2ray-core/releases/download/v4.31.0/v2ray-linux-64.zip
  - unzip -d /dist/v2milk/APP/extra/v2ray-core/Linux *Linux*.zip
# v2ray-core
- name: æ›´æ–°v2ray-core
  image: alpine
  volumes:
  - name: cache
    path: /dist
  commands:
  - apk update
  - apk add unzip wget
  - cd /dist/download
  - wget https://github.com/v2fly/v2ray-core/releases/download/v4.31.0/v2ray-windows-64.zip
  - unzip -d /dist/v2milk/APP/extra/v2ray-core/Windows *windows.zip
# æ„å»ºå®‰è£…åŒ…
- name: æ„å»ºå®‰è£…åŒ…
  image: node:12
  volumes:
  - name: cache
    path: /dist
  commands:
  - cd /dist/v2milk/APP
  - npm install
  - npm install -g electron-builder
  - npm run dist:win64
# mv
volumes:
- name: cache
  temp: {}
